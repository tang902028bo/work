(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["role"],{"30eb":function(e,t,n){},"39b3":function(e,t,n){"use strict";var o=n("f8f6"),r=n.n(o);r.a},a296:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-row",[n("el-col",{attrs:{span:4}},[n("role-list",{on:{setRole:e.setRole}})],1),n("el-col",{attrs:{span:20}},[n("permission",{attrs:{role:e.roleData}})],1)],1)},r=[],s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"role-box"},[n("h3",[n("el-row",[n("el-col",{attrs:{span:16}},[e._v("公司角色")]),n("el-col",{attrs:{span:8}},[n("div",{staticClass:"add",on:{click:function(t){e.roleFormShow=!0}}},[n("i",{staticClass:"el-icon-plus"}),e._v("新增 ")])])],1)],1),e._l(e.roleList,(function(t,o){return n("el-row",{key:o,class:["item",e.selectRoleId==t.id?"active":""],nativeOn:{click:function(n){return e.handleSelectRole(t)}}},[n("el-col",{attrs:{span:16}},[e._v(e._s(t.role_name))]),n("el-col",{attrs:{span:8}},[t.is_system?[n("span",{staticClass:"color-info"},[e._v("系统默认")])]:[n("el-tooltip",{attrs:{placement:"bottom",content:"编辑"}},[n("i",{staticClass:"el-icon-edit",on:{click:function(n){return e.handleEdit(t)}}})]),n("el-tooltip",{attrs:{placement:"bottom",content:"删除"}},[n("i",{staticClass:"el-icon-delete",on:{click:function(n){return e.handleDel(t.id)}}})])]],2)],1)})),n("el-dialog",{attrs:{title:e.form.id?"编辑":"新增",visible:e.roleFormShow},on:{"update:visible":function(t){e.roleFormShow=t}}},[n("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"名字",prop:"name",rules:[{required:!0,message:"请输入角色名字",trigger:"blur"}]}},[n("el-input",{attrs:{placeholder:"请输入角色名字"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),n("el-form-item",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"mini"},on:{click:function(t){e.roleFormShow=!1}}},[e._v("取消")]),n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.saveData("form")}}},[e._v("确定")])],1)],1)],2)},i=[],a=(n("b0c0"),n("96cf"),n("1da1")),c=n("365c"),l={data:function(){return{roleList:[],selectRoleId:"",form:{id:"",name:""},roleFormShow:!1}},created:function(){this.getRoleData()},methods:{getRoleData:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c["b"].getRoleList();case 2:n=t.sent,o=n.code,n.msg,1===o&&(e.roleList=data,e.handleSelectRole(e.roleList[0]));case 6:case"end":return t.stop()}}),t)})))()},handleEdit:function(e){this.form.id=e.id,this.form.name=e.role_name,this.roleFormShow=!0},handleSelectRole:function(e){this.selectRoleId=e.id,this.$emit("setRole",e)},handleDel:function(e){var t=this;this.$confirm("是否删除该角色","提升",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$axios.post("/admin/role/del_role",{id:e}).then((function(e){1==e.code&&(t.$message.success("删除成功"),t.getRoleData())})).catch((function(e){console.log(e)}))})).catch((function(){}))},saveData:function(e){var t=this;this.$refs[e].validate((function(e){e&&t.$axios.post("/admin/role/edit_role",t.form).then((function(e){e.code?(t.form.id="",t.form.name="",t.roleFormShow=!1,t.getRoleData(),t.$message.success(e.msg)):t.$message.error(e.msg)}))}))}}},u=l,d=(n("39b3"),n("2877")),m=Object(d["a"])(u,s,i,!1,null,"59df7ec0",null),f=m.exports,h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"permission-box"},[n("h3",[e._v(e._s(e.role.role_name)+" 设置")]),n("div",{staticClass:"nav-title"},[e._v("操作权限")]),n("div",{staticClass:"box"},e._l(e.permission,(function(t,o){return n("div",{key:o,staticClass:"item-box"},[n("div",{staticClass:"title"},[e._v(e._s(t.name)+" 设置")]),n("div",{staticClass:"permission"},[n("div",{staticClass:"item"},e._l(t.children,(function(t,o){return n("el-checkbox",{key:o,attrs:{disabled:!!e.role.is_system,label:t.id},on:{change:function(n){return e.handleSetRoles(t)}},model:{value:t.checked,callback:function(n){e.$set(t,"checked",n)},expression:"perItem.checked"}},[e._v(e._s(t.name))])})),1)])])})),0)])},p=[],v=(n("4160"),n("b64b"),n("159b"),{props:["role"],data:function(){return{permission:[],permissionList:[],type:{1:"组织架构",2:"角色管理",3:"司机管理",4:"车辆管理",6:"车辆类型管理",7:"用车管理",8:"用车审批",9:"数据统计"},checkedList:[]}},watch:{role:function(e){this.changeRoleData(e)}},created:function(){this.getPermissionShow()},methods:{getPermissionShow:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c["b"].getPermission();case 2:n=t.sent,o=n.code,n.msg,1==o&&(e.permissionList=res.data,e.permission=e.covertData(res.data),e.changeRoleData(e.role));case 6:case"end":return t.stop()}}),t)})))()},getPermission:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,o,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(""!==e.role.id&&void 0!==e.role.id&&null!==e.role.id){t.next=2;break}return t.abrupt("return",!1);case 2:return t.next=4,c["b"].getPermission({role_id:e.role.id});case 4:n=t.sent,o=n.code,r=n.data,n.msg,1==o&&(s=[],e.permissionList.forEach((function(e){for(var t in r)if(e.id===r[t].id)return e.checked=!!r[t].status,s.push(e),!1;s.push(e)})),e.permission=e.covertData(s));case 9:case"end":return t.stop()}}),t)})))()},changeRoleData:function(e){e.is_system?this.permission.forEach((function(e){e.children.forEach((function(e){e.checked=!0}))})):(this.permission.forEach((function(e){e.children.forEach((function(e){e.checked=!1}))})),this.getPermission())},covertData:function(e){var t=this,n=this.type,o=[];return Object.keys(n).forEach((function(r){var s={};s.name=n[r];var i=[];e.forEach((function(e){e.type==r&&(t.role.is_system?e.checked=!1:e.checked=!!e.checked&&e.checked,i.push(e))})),s.children=i,o.push(s)})),o},handleSetRoles:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var o,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.$forceUpdate(),o={role_id:t.role.id,code:e.code,type:e.type,status:e.checked?1:0},n.next=4,c["b"].setPermission(o);case 4:r=n.sent,r.code;case 6:case"end":return n.stop()}}),n)})))()}}}),b=v,g=(n("c929"),Object(d["a"])(b,h,p,!1,null,"519922e2",null)),_=g.exports,w={components:{roleList:f,permission:_},data:function(){return{roleData:{}}},methods:{setRole:function(e){this.roleData=e}}},k=w,R=Object(d["a"])(k,o,r,!1,null,null,null);t["default"]=R.exports},c929:function(e,t,n){"use strict";var o=n("30eb"),r=n.n(o);r.a},f8f6:function(e,t,n){}}]);