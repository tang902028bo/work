(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["depart","approveList"],{"3c2c":function(t,e,a){},6012:function(t,e,a){"use strict";var n=a("3c2c"),r=a.n(n);r.a},7924:function(t,e,a){"use strict";var n=a("d997"),r=a.n(n);r.a},7952:function(t,e,a){"use strict";var n=a("e859"),r=a.n(n);r.a},"9b59":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"user-list_box"},[a("el-row",{staticClass:"btn"},[a("el-col",{staticClass:"title",attrs:{span:18}},[t._v("用户列表")]),a("el-col",{staticClass:"right-btn",attrs:{span:6}},[a("el-button",{attrs:{type:"primary",size:"medium",loading:t.btnOptions.tagsLoading},on:{click:t.handleSyncTag}},[t._v(t._s(t.btnOptions.tagsTxt))]),a("el-button",{attrs:{type:"primary",size:"medium",loading:t.btnOptions.departLoading},on:{click:t.handleSyncDepart}},[t._v(t._s(t.btnOptions.departTxt))])],1)],1),a("el-row",[a("el-col",{attrs:{span:5}},[t._v(" 已选 "+t._s(t.selectNumber)+" 位用户 "),a("el-button",{attrs:{type:"primary",size:"medium",disabled:0==t.selectNumber},on:{click:function(e){return t.handleEdit("all",t.selectData)}}},[t._v("批量编辑")])],1),a("el-col",{attrs:{span:19}},[a("el-form",{attrs:{model:t.searchInfo,inline:!0}},[a("el-form-item",{attrs:{label:"姓名:"}},[a("el-input",{attrs:{size:"medium",placeholder:"请输入姓名",clearable:""},model:{value:t.searchInfo.name,callback:function(e){t.$set(t.searchInfo,"name",e)},expression:"searchInfo.name"}})],1),a("el-form-item",{attrs:{label:"手机号:"}},[a("el-input",{attrs:{size:"medium",placeholder:"请输入手机号",clearable:""},model:{value:t.searchInfo.mobile,callback:function(e){t.$set(t.searchInfo,"mobile",e)},expression:"searchInfo.mobile"}})],1),a("el-form-item",{attrs:{label:"角色:"}},[a("el-select",{staticClass:"role",attrs:{size:"medium",placeholder:"请选择角色",clearable:""},model:{value:t.searchInfo.u_roles,callback:function(e){t.$set(t.searchInfo,"u_roles",e)},expression:"searchInfo.u_roles"}},t._l(t.roleList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.role_name,value:t.id}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.handleSearch}},[t._v("查询")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.6)","header-cell-style":t.headClass,data:t.tableData,height:"410"},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",align:"center",width:"55"}}),a("el-table-column",{attrs:{prop:"name",label:"姓名"}}),a("el-table-column",{attrs:{label:"性别"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(0==e.row.gender?"保密":1==e.row.gender?"男":"女")+" ")]}}])}),a("el-table-column",{attrs:{label:"头像"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("img",{staticStyle:{width:"100px"},attrs:{src:t._f("formatAvatar")(e.row.avatar,t.getRootPath)}}),a("el-avatar",{attrs:{slot:"reference",shape:"square",size:"small",src:t._f("formatAvatar")(e.row.avatar,t.getRootPath)},slot:"reference"})],1)]}}])}),a("el-table-column",{attrs:{prop:"mobile",label:"手机号"}}),a("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),a("el-table-column",{attrs:{prop:"department_name","show-overflow-tooltip":"",label:"部门"}}),a("el-table-column",{attrs:{prop:"position","show-overflow-tooltip":"",label:"职位"}}),a("el-table-column",{attrs:{prop:"u_role_name",label:"角色"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.handleEdit("single",e.row)}}},[t._v("编辑")])]}}])})],1),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{background:"","page-sizes":[10,20,30],"page-size":t.pageInfo.limit,layout:"prev, pager, next, jumper, total, sizes",total:t.pageInfo.total},on:{"size-change":t.handleSizeChange,"current-change":t.handlePageChange}})],1),a("edit-info",{attrs:{show:t.editShow,roleList:t.roleList,data:t.editData,type:t.type},on:{"update:show":function(e){t.editShow=e},update:t.getUserData}})],1)},r=[],o=(a("caad"),a("ac1f"),a("2532"),a("1276"),a("96cf"),a("1da1")),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"pickUserBox",attrs:{title:"编辑信息",visible:t.editShow,width:"550px"},on:{"update:visible":function(e){t.editShow=e}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"editForm",staticClass:"editForm",attrs:{model:t.formData,rules:t.rules,"label-width":"80px"}},["single"==t.type?a("el-form-item",{attrs:{label:"姓名"}},[a("el-input",{attrs:{disabled:""},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1):t._e(),a("el-form-item",{attrs:{label:"角色",prop:"role_id"}},[a("el-select",{attrs:{placeholder:"请选择角色"},model:{value:t.formData.role_id,callback:function(e){t.$set(t.formData,"role_id",e)},expression:"formData.role_id"}},t._l(t.roleList,(function(t,e){return a("el-option",{key:e,attrs:{label:t.role_name,value:t.id}})})),1)],1),"single"==t.type?a("el-form-item",{attrs:{label:"入职时间"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:t.formData.entry_date,callback:function(e){t.$set(t.formData,"entry_date",e)},expression:"formData.entry_date"}})],1):t._e(),"single"==t.type?a("el-form-item",{attrs:{label:"转正时间"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:t.formData.formal_date,callback:function(e){t.$set(t.formData,"formal_date",e)},expression:"formData.formal_date"}})],1):t._e(),a("el-form-item",[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t.editShow=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.saveData("editForm")}}},[t._v("确定")])],1)],1)],1)},s=[],l=(a("a15b"),a("d81d"),a("b0c0"),a("a9e3"),a("365c")),c={props:["show","roleList","data","type"],data:function(){return{loading:!0,formData:{id:"",name:"",role_id:"",entry_date:"",formal_date:""},rules:{role_id:[{required:!0,message:"请选择角色",trigger:"blur"}]}}},watch:{data:function(){this.setData()}},created:function(){var t=this;setTimeout((function(){t.data&&t.setData(),t.loading=!1}),1e3)},computed:{editShow:{get:function(){return this.show},set:function(t){this.$emit("update:show",t)}}},methods:{setData:function(){if("single"===this.type)this.formData.id=this.data.id,this.formData.name=this.data.name,this.formData.role_id=Number(this.data.u_roles)>0?Number(this.data.u_roles):"",this.formData.entry_date=this.data.entry_date?new Date(this.data.entry_date):"",this.formData.formal_date=this.data.formal_date?new Date(this.data.formal_date):"";else{var t={id:this.data.map((function(t){return t.id})).join(","),role_id:""};this.formData=t}},setRole:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:try{a=l["b"].setRole(t.formData),n=a.code,a.msg,200==n&&(t.$message.success(res.msg),t.editShow=!1,t.$emit("update"))}catch(r){}case 1:case"end":return e.stop()}}),e)})))()},saveData:function(t){var e=this;this.$refs[t].validate((function(t){t&&e.setRole()}))}}},d=c,u=(a("7952"),a("2877")),p=Object(u["a"])(d,i,s,!1,null,"4c2e4ca7",null),f=p.exports,m={props:["departData"],components:{editInfo:f},data:function(){return{searchInfo:{name:"",mobile:"",u_roles:"",date:""},roleList:[],tableData:[],loading:!0,pageInfo:{page:1,limit:10,total:0},editShow:!1,editData:"",selectNumber:0,type:"",selectData:[],btnOptions:{departLoading:!1,departTxt:"同步组织架构",tagsLoading:!1,tagsTxt:"同步标签"}}},watch:{departData:function(t){this.searchInfo.dep_id=t.id,this.getUserData()}},created:function(){this.getUserData(),this.getRoleData()},filters:{formatAvatar:function(t,e){var a="",n="http://".concat(e.split("/")[2]);return a=t.includes("http")||t.includes("https")?t:n+t,a}},computed:{getRootPath:function(){return this.$store.state.common.rootPath},headClass:function(){return{background:"#F2F3F5"}}},methods:{getUserData:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,n,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=Object.assign(t.searchInfo,t.pageInfo),t.loading=!0;try{n=l["b"].getUserList(a),r=n.code,o=n.data,n.msg,1==r?(t.tableData=o,t.pageInfo.total=res.total):t.loading=!1}catch(i){t.loading=!1}case 3:case"end":return e.stop()}}),e)})))()},getRoleData:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=l["b"].getRoleList(),n=a.code,r=a.data,a.msg,1==n&&(t.roleList=r);case 2:case"end":return e.stop()}}),e)})))()},handleSearch:function(){this.pageInfo.page=1,this.getUserData()},handlePageChange:function(t){this.pageInfo.page=t,this.getUserData()},handleSizeChange:function(t){this.pageInfo.limit=t,this.getUserData()},handleEdit:function(t,e){this.editShow=!0,this.editData=e,this.type=t},handleSelectionChange:function(t){this.selectData=t,this.selectNumber=t.length},syncData:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{"struc"==t?(n=l["b"].syncStrucData(),n.code,e.btnOptions.departLoading=!0,e.btnOptions.departTxt="同步组织架构"):(r=l["b"].syncTagData(),r.code,e.btnOptions.tagsLoading=!1,e.btnOptions.tagsTxt="同步标签"),1===code?(e.$message.success("同步成功"),e.$emit("reload")):e.$message.error("同步失败"),e.getUserData()}catch(o){e.$message.error("同步失败")}case 1:case"end":return a.stop()}}),a)})))()},handleSyncDepart:function(){var t=this;this.$confirm("请确认企业微信后台应用可见范围内，包含您本人，否则同步后您将被禁止登陆，确定同步吗？","同步组织架构",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.btnOptions.departLoading=!0,t.btnOptions.departTxt="同步中...",t.syncData("struc")})).catch((function(){}))},handleSyncTag:function(){var t=this;this.$confirm("确定同步标签吗？","同步标签",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.btnOptions.tagsLoading=!0,t.btnOptions.tagsTxt="同步中...",t.syncData("tag")})).catch((function(){}))}}},h=m,g=(a("6012"),Object(u["a"])(h,n,r,!1,null,"53fd2728",null));e["default"]=g.exports},"9fb0":function(t,e,a){},a15b:function(t,e,a){"use strict";var n=a("23e7"),r=a("44ad"),o=a("fc6a"),i=a("a640"),s=[].join,l=r!=Object,c=i("join",",");n({target:"Array",proto:!0,forced:l||!c},{join:function(t){return s.call(o(this),void 0===t?",":t)}})},a68b:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{staticClass:"depart-box"},[a("div",{staticClass:"title"},[t._v("部门和用户设置")]),a("el-col",{staticClass:"left-box",attrs:{span:4}},[a("framework",{attrs:{reload:t.reload},on:{changeDepart:t.handlDepartChange,"update:reload":function(e){t.reload=e}}})],1),a("el-col",{attrs:{span:20}},[a("framework-list",{attrs:{departData:t.departData},on:{reload:t.reloadData}})],1)],1)},r=[],o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-scrollbar",{staticClass:"framework",staticStyle:{height:"600px"},attrs:{vertical:!0}},[a("div",{staticClass:"title"},[t._v("公司组织架构")]),a("el-tree",{attrs:{data:t.data,props:t.defaultProps,"default-expand-all":!0,"expand-on-click-node":!1,"check-on-click-node":!0},on:{check:t.handleDepartClick},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.node,r=e.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[a("i",{class:r.isuser?"el-icon-user":"el-icon-folder"}),t._v(" "+t._s(n.label)+" ")])])}}])})],1)},i=[],s=(a("96cf"),a("1da1")),l=a("365c"),c={props:["reload"],data:function(){return{data:[],defaultProps:{children:"children",label:"dep_name"}}},watch:{reload:function(t){t&&this.getDepartData()}},computed:{_reload:{get:function(){return this.reload},set:function(){this.$emit("update:reload",!1)}}},created:function(){this.getDepartData()},methods:{getDepartData:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l["b"].getDepartList();case 3:a=e.sent,n=a.code,r=a.data,1==n&&(t.data=t.buildTree(r),t._reload=!1),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](0),t._reload=!1;case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))()},buildTree:function(t){var e={},a=[];for(var n in t)e[t[n].id]=t[n];for(var r in e)e[r].parentid?(e[e[r].parentid].children||(e[e[r].parentid].children=new Array),e[e[r].parentid].children.push(e[r])):a.push(e[r]);return a},handleDepartClick:function(t){this.$emit("changeDepart",t)}}},d=c,u=(a("dea1"),a("2877")),p=Object(u["a"])(d,o,i,!1,null,"5d95068c",null),f=p.exports,m=a("9b59"),h={data:function(){return{departData:"",reload:!1}},components:{framework:f,frameworkList:m["default"]},methods:{handlDepartChange:function(t){this.departData=t},reloadData:function(){this.reload=!0}}},g=h,b=(a("7924"),Object(u["a"])(g,n,r,!1,null,"8f5fb084",null));e["default"]=b.exports},d997:function(t,e,a){},dea1:function(t,e,a){"use strict";var n=a("9fb0"),r=a.n(n);r.a},e859:function(t,e,a){}}]);