(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["approve"],{"02d2":function(e,a,t){"use strict";t.r(a);var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("van-skeleton",{attrs:{title:"",avatar:"",row:3,loading:e.loading}},[t("div",{staticClass:"info-box"},[t("div",{staticClass:"info"},[t("div",{staticClass:"title"},[t("van-image",{attrs:{width:"56",height:"56",src:e.info.avatar,radius:"4"}}),t("span",[e._v(e._s(e.info.user_name)+"的用车申请记录")]),0==e.info.status?t("van-tag",{attrs:{plain:"",type:"primary"}},[e._v("待审批")]):1==e.info.status&&1==e.info.car_use_status?t("van-tag",{attrs:{plain:"",type:"success"}},[e._v("已通过-等待出行")]):2==e.info.status?t("van-tag",{attrs:{plain:"",type:"warning"}},[e._v("已驳回")]):3==e.info.status?t("van-tag",{attrs:{plain:""}},[e._v("已撤销")]):1==e.info.status&&2==e.info.car_use_status?t("van-tag",{attrs:{plain:"",type:"primary"}},[e._v("已出场-用车中")]):1==e.info.status&&3==e.info.car_use_status?t("van-tag",{attrs:{plain:"",type:"primary"}},[e._v("已出场-回程中")]):1==e.info.status&&4==e.info.car_use_status?t("van-tag",{attrs:{plain:"",type:"primary"}},[e._v("已回场-用车结束")]):4==e.info.status&&0==e.info.car_use_status?t("van-tag",{attrs:{plain:"",type:"warning"}},[e._v("取消用车")]):t("van-tag",{attrs:{plain:"",type:"primary"}},[e._v("已完成")])],1),t("div",{staticClass:"apply-info"},[t("p",[t("span",{staticClass:"prop-name"},[e._v("用车编号：")]),e._v(" "+e._s(e.info.approval_sn)+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("申请时间：")]),e._v(" "+e._s(e._f("timeFormat")(e.info.createtime,"yyyy-mm-dd"))+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("用车人电话：")]),e._v(" "+e._s(e.info.mobile)+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("所在部门：")]),e._v(" "+e._s(e.info.department_name)+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("车辆类型：")]),e._v(" "+e._s(e.info.type_name)+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("开始时间：")]),e._v(" "+e._s(e._f("timeFormat")(e.info.start_time,"yyyy-mm-dd"))+" ")]),t("div",{staticClass:"passager-box"},[t("span",{staticClass:"prop-name"},[e._v("司机：")]),1==e.info.have_driver?t("span",[t("span",{staticClass:"name"},[e._v(e._s(e.info.driver_name?e.info.driver_name:"无"))])]):e._e()]),t("p",[t("span",{staticClass:"prop-name"},[e._v("乘车人数：")]),e._v(" "+e._s(e.info.all_userid)+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("出发地：")]),e._v(" "+e._s(e.info.from_address)+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("目的地：")]),e._v(" "+e._s(e.info.to_address)+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("司机配备：")]),e._v(" "+e._s(1==e.info.have_driver?"需要":"不需要")+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("用车事由：")]),e._v(" "+e._s(e.info.cause)+" ")]),t("p",[e.info.log_cause?t("span",{staticClass:"prop-name"},[e._v("备注：")]):e._e(),t("span",{staticStyle:{color:"red"}},[e._v(e._s(e.info.log_cause))])])])]),t("div",{staticClass:"approve-box"},[t("div",{staticClass:"title"},[e._v("审批流程")]),t("van-steps",{attrs:{direction:"vertical",active:e.active,"active-color":"#0082EF"}},e._l(e.info.progress,(function(a,r){return t("van-step",{key:r,scopedSlots:e._u([e.active==r&&1==a.is_approval?{key:"active-icon",fn:function(){return[t("van-icon",{staticClass:"success",attrs:{name:"checked"}})]},proxy:!0}:2==a.is_approval?{key:"active-icon",fn:function(){return[t("van-icon",{staticClass:"close",attrs:{name:"clear"}})]},proxy:!0}:{key:"active-icon",fn:function(){return[t("i",{staticClass:"aprove"})]},proxy:!0}],null,!0)},[t("div",{staticClass:"item"},[t("div",{staticClass:"photo"},[t("van-icon",{attrs:{name:"friends"}})],1),t("div",{staticClass:"title"},[t("span",[t("span",{staticClass:"role-name"},[e._v(e._s(a.approve_name))]),1==a.is_approval?t("span",[e._v("·已同意")]):2==a.is_approval?t("span",[e._v("·已驳回")]):t("span",[e._v("·审核中")])]),t("span",[e._v("("+e._s(a.is_approval_number)+"/"+e._s(a.approval_number)+")")]),t("van-tag",{attrs:{type:"primary",plain:"",color:"#467DB9"}},[e._v(e._s(1===a.type?"会签":"或签"))]),t("van-icon",{attrs:{name:a.show?"arrow-up":"arrow-down"},on:{click:function(a){return e.handleUserShow(r)}}}),a.is_approval_time>0?t("div",{staticClass:"time"},[t("span",[e._v(e._s(e._f("timeFormat")(a.is_approval_time,"mm-dd hh:mm")))])]):e._e()],1)]),t("ul",{directives:[{name:"show",rawName:"v-show",value:a.show,expression:"item.show"}],staticClass:"user-list"},e._l(a.user_list,(function(a){return t("li",{key:a.id},[t("div",{staticClass:"left"},[t("div",{staticClass:"photo"},[t("img",{attrs:{src:a.avatar}})]),e._v(" "+e._s(a.role_name?"("+a.role_name+")":"")+" "),t("span",[e._v(e._s(a.name)+e._s(1==a.is_approval?"·已同意":2==a.is_approval?"·已驳回":""))])]),a.is_approval_time>0?t("div",{staticClass:"time"},[e._v(e._s(e._f("timeFormat")(a.is_approval_time,"mm-dd hh:mm")))]):e._e()])})),0)])})),1)],1),t("div",{staticClass:"copyer"},[e._v("抄送人："+e._s(1==e.info.have_driver?"司机、":"")+e._s(e.info.copyer_name))]),e._l(e.car_info,(function(a){return t("div",{key:a.car_number,staticClass:"box car-info"},[t("div",{staticClass:"title"},[e._v("车辆信息")]),t("div",{staticClass:"info"},[t("p",[e._v("车牌号："+e._s(a.car_number)+","+e._s(e.car_info.type_name))]),t("p",[e._v("车辆当前里程："+e._s(a.drive_km)+"公里")])])])})),e.out_check_info?t("div",{staticClass:"box leave-info"},[t("div",{staticClass:"title"},[e._v("出场登记")]),t("div",{staticClass:"info"},[t("div",[t("span",[e._v("出场前里程：")]),t("span",[e._v(e._s(e.out_check_info.drive_km)+"公里")])]),t("p",[t("span",[e._v("备注：")]),t("span",[e._v(e._s(e.out_check_info.prompt))])])])]):e._e(),e.return_check_info?t("div",{staticClass:"box leave-info"},[t("div",{staticClass:"title"},[e._v("回场登记")]),t("div",{staticClass:"info"},[t("div",[t("span",[e._v("回场前里程：")]),t("span",[e._v(e._s(e.return_check_info.drive_km)+"公里")])]),t("div",[t("span",[e._v("行驶里程：")]),t("span",[e._v(e._s(e.return_check_info.travel_mileage)+"公里")])]),t("p",[t("span",[e._v("备注：")]),t("span",[e._v(e._s(e.return_check_info.prompt))])])])]):e._e()],2)])},s=[],i=(t("99af"),t("4de4"),t("4160"),t("a15b"),t("d81d"),t("b0c0"),t("159b"),t("96cf"),t("1da1")),n=t("365c"),o=t("61f7"),c={data:function(){return{loading:!0,id:"",info:{approval_sn:"",have_driver:"",mobile:"",from_address:"",to_address:"",all_userid:1,department:"",avatar:"",user_name:"",start_time:"",end_time:"",cause:"",createtime:"",status:"",car_use_status:"",type_name:"",department_name:"",all_user:[]},car_info:{},out_check_info:{},return_check_info:{},active:-1}},created:function(){this.id=this.$route.params.id,this.getData(),this.getOtherInfo()},methods:{getData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var t,r,s,i,c,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,n["a"].getInfo({id:e.id,type:3});case 2:t=a.sent,r=t.msg,s=t.code,i=t.data,200===s?(e.loading=!1,c="",l="",e.info=Object.assign({},i),Object(o["a"])(e.info.from_address)&&(c=JSON.parse(e.info.from_address),l=JSON.parse(e.info.to_address),e.info.from_address="".concat(c.area," ").concat(c.detail),e.info.to_address="".concat(l.area," ").concat(l.detail)),e.info.progress=e.converProgress(e.info.progress),e.info.copyer_name=Array.isArray(e.info.copyer_user)?e.info.copyer_user.map((function(e){return e.name})).join("、"):""):(e.$notify({type:"danger",message:r,duration:1e3}),e.$router.push("/notice"));case 7:case"end":return a.stop()}}),a)})))()},getOtherInfo:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var t,r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,n["c"].getOtherInfo({id:e.id});case 3:t=a.sent,r=t.code,s=t.data,200===r&&(e.car_info=s.car_info,e.out_check_info=s.out_check_info,e.return_check_info=s.return_check_info),a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](0),console.log(a.t0);case 12:case"end":return a.stop()}}),a,null,[[0,9]])})))()},converProgress:function(e){var a=this;return e.forEach((function(e){var t=[];1===e.approver_type?(e.user_list=e.leader_arr,e.approve_name="上级主管"):(e.user_list=e.role_user_arr,e.approve_name=e.approval_role.map((function(e){return e.role_name})).join("/")),t=e.user_list.filter((function(e){return e.is_approval>0})),e.show=!1,e.approval_number=e.user_list.length,e.is_approval_number=t.length,e.is_approval_time=e.is_approval_number>0?t[0].is_approval_time:0,e.is_approval=e.is_approval_number>0?t[0].is_approval:"",1==e.is_deal_approval&&(e.is_approval=e.last_approval_status,a.active++)})),e},handleUserShow:function(e){this.info.progress[e].show=!this.info.progress[e].show,this.$forceUpdate()}}},l=c,p=(t("b3fc"),t("2877")),u=Object(p["a"])(l,r,s,!1,null,"14742bf7",null);a["default"]=u.exports},"02e1":function(e,a,t){},"129f":function(e,a){e.exports=Object.is||function(e,a){return e===a?0!==e||1/e===1/a:e!=e&&a!=a}},"17d6":function(e,a,t){"use strict";t.r(a);var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("van-form",{staticClass:"add-approve",on:{submit:e.onSubmit}},[t("van-field",{attrs:{required:"",name:"user_id",label:"用车人","input-align":"right",autocomplete:"false","right-icon":"arrow",readonly:"",placeholder:"请选择用车人",rules:[{required:!0,message:"请选择用车人",trigger:"onChange"}]},on:{click:function(a){e.showPickerUser=!0,e.single=!0,e.pickerUserType="userid"}},model:{value:e.pickCheckName.user,callback:function(a){e.$set(e.pickCheckName,"user",a)},expression:"pickCheckName.user"}}),t("van-field",{attrs:{required:"",name:"depart",label:"部门",autocomplete:"false",readonly:"","input-align":"right","right-icon":"arrow",placeholder:"请选择部门",rules:[{required:!0,message:"请选择部门",trigger:"onChange"}]},on:{click:e.handleDepart},model:{value:e.pickCheckName.depart,callback:function(a){e.$set(e.pickCheckName,"depart",a)},expression:"pickCheckName.depart"}}),t("van-field",{attrs:{required:"",name:"all_userid",label:"乘车人数",type:"digit","input-align":"right",placeholder:"请输入乘车人数"},model:{value:e.form.all_userid,callback:function(a){e.$set(e.form,"all_userid",a)},expression:"form.all_userid"}}),t("van-field",{attrs:{required:"",readonly:"",clickable:"",name:"startTime",value:e.form.start_time,label:"开始时间",placeholder:"点击选择日期","input-align":"right","right-icon":"arrow",rules:[{required:!0,message:"请选择开始时间",trigger:"onChange"}]},on:{click:function(a){e.showCalendar=!0,e.pickType="start_time"}}}),t("van-field",{attrs:{required:"",name:"car_id",label:"指派车辆","input-align":"right",autocomplete:"false","right-icon":"arrow",readonly:"",placeholder:"请选择车辆类型、车牌号",rules:[{required:!0,message:"请选择车辆类型、车牌号",trigger:"onChange"}]},on:{click:function(a){e.showPickerCar=!0}},model:{value:e.pickCheckName.car_number,callback:function(a){e.$set(e.pickCheckName,"car_number",a)},expression:"pickCheckName.car_number"}}),t("van-field",{attrs:{required:"",name:"haveDriver",label:"司机配置","input-align":"right"},scopedSlots:e._u([{key:"input",fn:function(){return[t("van-radio-group",{attrs:{direction:"horizontal"},model:{value:e.form.have_driver,callback:function(a){e.$set(e.form,"have_driver",a)},expression:"form.have_driver"}},[t("van-radio",{attrs:{name:"1","checked-color":"#467DB9"}},[e._v("是")]),t("van-radio",{attrs:{name:"2","checked-color":"#467DB9"}},[e._v("否")])],1)]},proxy:!0}])}),1==e.form.have_driver?t("van-field",{attrs:{required:"",name:"driver_id",label:"指派司机","input-align":"right",autocomplete:"false","right-icon":"arrow",readonly:"",placeholder:"请选择司机",rules:[{required:!0,message:"请选择司机",trigger:"onChange"}]},on:{click:function(a){e.showPickerDriver=!0}},model:{value:e.pickCheckName.driver,callback:function(a){e.$set(e.pickCheckName,"driver",a)},expression:"pickCheckName.driver"}}):e._e(),t("van-field",{attrs:{required:"",readonly:"",clickable:"",name:"area",value:e.form.from_address,label:"出发地",placeholder:"请选择出发地","input-align":"right","right-icon":"arrow",rules:[{required:!0,message:"请选择出发地",trigger:"onChange"}]},on:{click:function(a){e.showPickerAddress=!0,e.areaType="from_address"}}}),t("van-field",{attrs:{readonly:"",clickable:"",required:"",name:"area",value:e.form.to_address,label:"目的地",placeholder:"请选择目的地","input-align":"right","right-icon":"arrow",rules:[{required:!0,message:"请选择目的地",trigger:"onChange"}]},on:{click:function(a){e.showPickerAddress=!0,e.areaType="to_address"}}}),t("van-field",{attrs:{type:"tel",required:"",label:"手机号",placeholder:"请输入手机号","input-align":"right",rules:[{pattern:/^1[3456789]\d{9}$/,message:"请输入正确手机号",trigger:"onChange"}]},model:{value:e.form.mobile,callback:function(a){e.$set(e.form,"mobile",a)},expression:"form.mobile"}}),t("van-field",{attrs:{rows:"2",autosize:"",label:"用车事由",type:"textarea",maxlength:"50",placeholder:"用车事由","show-word-limit":""},model:{value:e.form.cause,callback:function(a){e.$set(e.form,"cause",a)},expression:"form.cause"}}),t("div",{staticClass:"approve-box"},[t("div",{staticClass:"item"},[t("div",{staticClass:"title"},[e._v(" 派车人 "),t("span",[e._v("（车队管理员直接派车，无需审批）")])]),t("ul",[t("li",[t("div",{staticClass:"photo"},[t("img",{attrs:{src:e.userInfo.avatar}})]),t("p",[e._v(e._s(e.userInfo.label))]),e.userInfo.role_names?t("van-tag",{attrs:{type:"primary",plain:"",color:"#467DB9"}},[e._v(e._s(e.userInfo.role_names))]):e._e()],1)])]),t("div",{staticClass:"item"},[t("div",{staticClass:"title"},[e._v("抄送人")]),t("ul",[t("li",[t("div",{staticClass:"photo"},[t("van-icon",{attrs:{name:"friends"}})],1),t("p",[e._v("司机")])]),e._l(e.pickerUsers.copyer_id,(function(a,r){return t("li",{key:r},[t("div",{staticClass:"photo"},[a.avatar?t("img",{attrs:{src:e.formatImgUrl(a.avatar)}}):t("van-icon",{attrs:{name:"friends"}}),t("van-button",{staticClass:"close",attrs:{"native-type":"button"},on:{click:function(a){return e.handleDelUser(r,"copyer_id")}}},[t("van-icon",{attrs:{name:"cross"}})],1)],1),t("p",[e._v(e._s(a.name))])])})),t("li",[t("van-button",{staticClass:"add",attrs:{"native-type":"button"},on:{click:function(a){e.showPickerUser=!0,e.single=!1,e.pickerUserType="copyer_id"}}},[t("van-icon",{attrs:{name:"plus"}})],1),t("p",{staticStyle:{"margin-top":"-1px"}},[e._v("添加")])],1)],2)])]),t("div",{staticStyle:{margin:"16px"}},[t("van-button",{attrs:{type:"info",size:"large",color:"#467db9","native-type":"submit",loading:e.button.loading,"loading-text":e.button.loadingTxt}},[e._v("提交")])],1),t("van-calendar",{attrs:{color:"#467db9"},on:{confirm:e.handleDateChange},model:{value:e.showCalendar,callback:function(a){e.showCalendar=a},expression:"showCalendar"}}),t("pickerUser",{attrs:{single:e.single,show:e.showPickerUser,data:e.pickerUsers[e.pickerUserType]},on:{"update:show":function(a){e.showPickerUser=a},done:e.pickerUserDone}}),t("picker-address",{attrs:{show:e.showPickerAddress,data:e.pickerAddress[e.areaType]},on:{"update:show":function(a){e.showPickerAddress=a},done:e.pickerAddressDone}}),t("picker-car",{attrs:{show:e.showPickerCar,single:!0,data:e.pickerCarData},on:{"update:show":function(a){e.showPickerCar=a},done:e.pickerCarDone}}),t("picker-driver",{attrs:{show:e.showPickerDriver,single:!1,data:e.pickerDriverData},on:{"update:show":function(a){e.showPickerDriver=a},done:e.pickerDriverDone}}),t("van-popup",{attrs:{position:"bottom"},model:{value:e.showPicker,callback:function(a){e.showPicker=a},expression:"showPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:e.pickData[e.pickType]},on:{confirm:e.onConfirm,cancel:function(a){e.showPicker=!1}}})],1)],1)},s=[],i=(t("99af"),t("4de4"),t("caad"),t("a15b"),t("d81d"),t("a434"),t("b0c0"),t("2532"),t("96cf"),t("1da1")),n=t("33eb"),o=t("5eba"),c=t("17c3"),l=t("63c5"),p=t("d296"),u=t("adfd"),d=t("365c"),v=t("13aa"),h={components:{pickerUser:c["a"],pickerCar:l["a"],pickerDriver:p["a"],pickerAddress:u["a"]},data:function(){return{areaList:n["a"],showPicker:!1,showCalendar:!1,showPickerCar:!1,showPickerDriver:!1,activeIndex:"",activeId:"",pickType:"",showPickerUser:!1,showPickerAddress:!1,single:!0,form:{department_id:"",car_type_id:"",start_time:"",have_driver:"1",all_userid:"",from_address:"",to_address:"",mobile:"",cause:"",copyer_id:"",travel_mileage:1,type:2,userid:"",car_id:"",driver_id:""},pickData:{type:[],depart:[]},pickCheckName:{type:"",car_number:"",depart:"",driver:"",user:""},pickerUsers:{all_userid:[],copyer_id:[],userid:[]},pickerUserType:"all_userid",pickerDriverData:[],pickerCarData:[],areaType:"from_address",pickerAddress:{from_address:{},to_address:{}},typeData:[],stepList:[],copyerList:[],departList:[],button:{loading:!1,loadingTxt:"提交中..."},submit:!1}},computed:{userInfo:function(){return this.$store.state.user.userInfo},rootPath:function(){return this.$store.state.common.rootPath}},watch:{pickerUsers:{handler:function(e){this.single?(this.form.userid=e[this.pickerUserType][0].userid,this.pickCheckName.user=e[this.pickerUserType][0].name):this.form[this.pickerUserType]=e[this.pickerUserType].map((function(e){return e.userid})).join(",")},deep:!0}},methods:{formatImgUrl:function(e){return e.includes("http://")||e.includes("https://")?e:"".concat(this.rootPath).concat(e)},onConfirm:function(e){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:t.t0=a.pickType,t.next="depart"===t.t0?3:"type"===t.t0?5:7;break;case 3:return a.departList.length>0?(a.pickCheckName.depart=e,a.form.department_id=a.departList.filter((function(a){return a.dep_name===e}))[0].id):a.$notify({type:"danger",message:"当前用户没有部门，请联系管理员",duration:1e3}),t.abrupt("break",8);case 5:return a.typeData.length>0?(a.pickCheckName.type=e,a.form.car_type_id=a.typeData.filter((function(a){return a.name===e}))[0].id):a.$notify({type:"danger",message:"暂无车辆类型，请联系管理员",duration:1e3}),t.abrupt("break",8);case 7:return t.abrupt("break",8);case 8:a.showPicker=!1;case 9:case"end":return t.stop()}}),t)})))()},handleDateChange:function(e){this.form[this.pickType]=Object(o["a"])(e,"yyyy-MM-dd"),this.showCalendar=!1},pickerUserDone:function(e){this.pickerUsers[this.pickerUserType]=e,"userid"===this.pickerUserType&&this.getDepartData(e[0].userid)},handleDepart:function(){this.form.userid?(this.showPicker=!0,this.pickType="depart"):this.$notify({type:"danger",message:"请先选择用车人",duration:1e3})},pickerAddressDone:function(e){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a.form[a.areaType]="".concat(e.area," ").concat(e.detail),a.pickerAddress[a.areaType]=e,!a.form.from_address||!a.form.to_address){t.next=9;break}return r=a.pickerAddress.from_address.location,s=a.pickerAddress.to_address.location,t.next=7,v["a"].getDistance(r,s);case 7:a.form.travel_mileage=t.sent,0===a.form.travel_mileage&&(a.form.from_address="",a.pickerAddress.to_address={},a.$notify({type:"danger",message:"出发地和目的地不能相同",duration:1e3}));case 9:case"end":return t.stop()}}),t)})))()},handleDelUser:function(e,a){this.pickerUsers[a].splice(e,1)},pickerCarDone:function(e){this.pickerCarData=e,this.pickCheckName.car_number=e.map((function(e){return e.car_number})).join("、"),this.form.car_id=e.map((function(e){return e.id})).join(","),this.form.car_type_id=e.map((function(e){return e.type_id})).join(",")},pickerDriverDone:function(e){this.pickerDriverData=e,this.pickCheckName.driver=e.map((function(e){return e.realname})).join("、"),this.form.driver_id=e.map((function(e){return e.userid})).join(",")},getDepartData:function(e){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,d["d"].getUserInfo({userid:e});case 3:r=t.sent,s=r.data.dep_names,a.departList=s,a.pickData.depart=s.map((function(e){return e.dep_name})),a.pickCheckName.depart=s[0].dep_name,a.form.department_id=s[0].id,t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](0),console.log(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})))()},getTypeData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var t,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,d["e"].getList();case 3:t=a.sent,r=t.data,e.typeData=r,e.pickData.type=r.map((function(e){return e.name})),a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](0),console.log(a.t0);case 12:case"end":return a.stop()}}),a,null,[[0,9]])})))()},onSubmit:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var t,r,s,i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.button.loading=!0,t=e.$toast.loading({duration:0,forbidClick:!0,message:"数据提交中，请稍后..."}),a.prev=2,"2"===e.form.have_driver&&(e.form.dirver_id=""),r=Object.assign({},e.form),r.from_address=JSON.stringify(e.pickerAddress.from_address),r.to_address=JSON.stringify(e.pickerAddress.to_address),a.next=9,d["a"].approveAdd(r);case 9:s=a.sent,i=s.code,n=s.msg,t.clear(),e.button.loading=!1,200===i?(e.submit=!0,e.$notify({type:"success",message:n,duration:1e3}),e.$router.push("/approve")):e.$notify({type:"danger",message:n,duration:1e3}),a.next=21;break;case 17:a.prev=17,a.t0=a["catch"](2),console.log(a.t0),e.button.loading=!1;case 21:case"end":return a.stop()}}),a,null,[[2,17]])})))()}},beforeRouteLeave:function(e,a,t){this.submit?t():this.$dialog.confirm({title:"提示",message:"退出后内容将不会保存，您是否要继续?",confirmButtonColor:"#467db9",confirmButtonText:"继续填写"}).then((function(){t(!1)})).catch((function(){t()}))}},_=h,f=(t("9e73"),t("2877")),m=Object(f["a"])(_,r,s,!1,null,"9cbf2e96",null);a["default"]=m.exports},"52b1":function(e,a,t){"use strict";var r=t("cfd9"),s=t.n(r);s.a},"63c5":function(e,a,t){"use strict";var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return e._show?t("div",{staticClass:"pick-car"},[t("header",{ref:"container",attrs:{container:e.container}},[t("van-sticky",[t("van-search",{attrs:{placeholder:"搜索名字、类型","show-action":"",background:"#F5F5F5"},on:{search:e.handleSearch,cancel:e.handleCancel},model:{value:e.query.search,callback:function(a){e.$set(e.query,"search",a)},expression:"query.search"}})],1)],1),t("div",{staticClass:"select-box"},[t("div",{staticClass:"title"},[e._v("已选车辆")]),e.selectData.length?t("div",{staticClass:"list-box"},[t("van-row",{staticClass:"list-box"},e._l(e.selectData,(function(a){return t("van-col",{key:a.id,attrs:{span:"8"}},[t("div",{staticClass:"item",on:{click:function(t){return e.handleCheck("del",a)}}},[t("div",{staticClass:"name txt-color"},[e._v(e._s(a.car_number))]),t("div",{staticClass:"car-info"},[t("span",[e._v(e._s(a.type_name))]),t("span",{staticClass:"txt-color"},[e._v(e._s(a.seats_number)+"座")])])])])})),1)],1):e._e()]),t("div",{staticClass:"cars-box"},[t("div",{staticClass:"title"},[e._v("在库空闲车辆")]),t("van-row",[t("van-col",{staticClass:"tags",attrs:{span:"4"}},[e._v("车辆类型")]),t("van-col",{attrs:{span:"20"}},[t("van-tabs",{attrs:{"line-width":"0"},on:{change:function(a,t){e.handleTagsChange(a,t,"type_id")}}},e._l(e.typeList,(function(e){return t("van-tab",{key:e.id,attrs:{title:e.name,name:e.id}})})),1)],1)],1),t("van-pull-refresh",{on:{refresh:e.onRefresh},model:{value:e.refreshing,callback:function(a){e.refreshing=a},expression:"refreshing"}},[t("van-list",{staticClass:"list",attrs:{finished:e.finished,"finished-text":"没有更多了"},on:{load:e.onLoad},model:{value:e.loading,callback:function(a){e.loading=a},expression:"loading"}},[t("van-row",{staticClass:"list-box"},e._l(e.list,(function(a){return t("van-col",{key:a.id,attrs:{span:"8"}},[t("div",{staticClass:"item",on:{click:function(t){return e.handleCheck("",a)}}},[t("div",{staticClass:"name txt-color"},[e._v(e._s(a.car_number))]),t("div",{staticClass:"car-info"},[t("span",[e._v(e._s(a.type_name))]),t("span",{staticClass:"txt-color"},[e._v(e._s(a.seats_number)+"座")])])])])})),1)],1)],1)],1),t("div",{staticClass:"foot"},[t("div",[e._v(" 已选中 "),t("span",{staticClass:"num"},[e._v(e._s(e.selectNum))]),e._v("辆 ")]),t("div",[t("van-button",{attrs:{round:"",type:"info",color:"#2F7DCD"},on:{click:e.handleConfirm}},[e._v("确定")])],1)])]):e._e()},s=[],i=(t("99af"),t("a623"),t("4de4"),t("ac1f"),t("841c"),t("96cf"),t("1da1")),n=t("2909"),o=t("365c"),c={name:"PickerCar",props:{show:{type:Boolean,required:!0},data:{type:Array,default:function(){return[]}}},data:function(){return{list:[],loading:!1,finished:!1,refreshing:!1,query:{search:"",page:0,pagesize:40,car_status:0,type_id:""},count:0,container:null,selectData:[],typeList:[],title:""}},computed:{_show:{get:function(){return this.show},set:function(e){this.query.search="",this.query.type_id="",this.handleSearch(),this.$emit("update:show",e)}},selectNum:function(){return this.selectData.length}},watch:{_show:function(e){var a=this;e&&(this.selectData=this.data,this.list=Object(n["a"])(this.list).filter((function(e){return Object(n["a"])(a.selectData).every((function(a){return e.id!==a.id}))})))}},mounted:function(){this.container=this.$refs.container},methods:{onLoad:function(){this.getTypeData(),this.getCarData(),this.refreshing?(this.query.page=1,this.list=[],this.refreshing=!1):this.query.page++},getCarData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var t,r,s,i,c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,o["b"].getList(e.query);case 3:t=a.sent,r=t.code,s=t.data,i=s.list,c=s.count,200==r?(e.count=c,e.loading=!1,e.skeShow=!1,1===e.query.page?e.list=i:e.list=[].concat(Object(n["a"])(e.list),Object(n["a"])(i)),e.list.length>=e.count&&(e.finished=!0)):e.finished=!0,a.next=14;break;case 11:a.prev=11,a.t0=a["catch"](0),e.finished=!0;case 14:case"end":return a.stop()}}),a,null,[[0,11]])})))()},getTypeData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var t,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,o["e"].getList();case 3:t=a.sent,r=t.data,e.typeList=r,e.typeList.unshift({id:"",name:"全部"}),a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](0),console.log(a.t0);case 12:case"end":return a.stop()}}),a,null,[[0,9]])})))()},handleConfirm:function(){this.selectNum>0?(this._show=!1,this.$emit("done",this.selectData),this.query.search="",this.handleSearch()):this.$notify({type:"danger",message:"请选择车辆",duration:1e3})},handleSearch:function(){this.refreshing=!0,this.loading=!0,this.onLoad()},handleTagsChange:function(e,a,t){this.query[t]=e,this.title=a,this.handleSearch()},handleCheck:function(e,a){"del"==e?(this.list.push(a),this.selectData=this.selectData.filter((function(e){return e.id!=a.id}))):(this.selectData.push(a),this.list=this.list.filter((function(e){return e.id!=a.id})))},handleCancel:function(){this._show=!1},onRefresh:function(){this.finished=!1,this.loading=!0,this.onLoad()}}},l=c,p=(t("52b1"),t("2877")),u=Object(p["a"])(l,r,s,!1,null,"0536834e",null);a["a"]=u.exports},"841c":function(e,a,t){"use strict";var r=t("d784"),s=t("825a"),i=t("1d80"),n=t("129f"),o=t("14c3");r("search",1,(function(e,a,t){return[function(a){var t=i(this),r=void 0==a?void 0:a[e];return void 0!==r?r.call(a,t):new RegExp(a)[e](String(t))},function(e){var r=t(a,e,this);if(r.done)return r.value;var i=s(e),c=String(this),l=i.lastIndex;n(l,0)||(i.lastIndex=0);var p=o(i,c);return n(i.lastIndex,l)||(i.lastIndex=l),null===p?-1:p.index}]}))},"9e73":function(e,a,t){"use strict";var r=t("02e1"),s=t.n(r);s.a},a623:function(e,a,t){"use strict";var r=t("23e7"),s=t("b727").every,i=t("a640"),n=t("ae40"),o=i("every"),c=n("every");r({target:"Array",proto:!0,forced:!o||!c},{every:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}})},b3ee:function(e,a,t){},b3fc:function(e,a,t){"use strict";var r=t("b3ee"),s=t.n(r);s.a},c4303:function(e,a,t){},ca51:function(e,a,t){"use strict";var r=t("c4303"),s=t.n(r);s.a},cfd9:function(e,a,t){},d296:function(e,a,t){"use strict";var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return e._show?t("div",{staticClass:"pick-driver"},[t("header",{ref:"container",attrs:{container:e.container}},[t("van-sticky",[t("van-search",{attrs:{placeholder:"搜索名字/手机号","show-action":"",background:"#F5F5F5"},on:{search:e.handleSearch,cancel:e.handleCancel},model:{value:e.query.search,callback:function(a){e.$set(e.query,"search",a)},expression:"query.search"}})],1)],1),t("van-pull-refresh",{on:{refresh:e.onRefresh},model:{value:e.refreshing,callback:function(a){e.refreshing=a},expression:"refreshing"}},[t("van-list",{staticClass:"list",attrs:{finished:e.finished,"finished-text":"没有更多了"},on:{load:e.onLoad},model:{value:e.loading,callback:function(a){e.loading=a},expression:"loading"}},[e.single?t("van-radio-group",{model:{value:e.checkSingleData,callback:function(a){e.checkSingleData=a},expression:"checkSingleData"}},[t("van-cell-group",e._l(e.list,(function(a,r){return t("van-cell",{directives:[{name:"show",rawName:"v-show",value:a.show,expression:"item.show"}],key:r,scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(a.realname)+" "),0==a.status?t("van-tag",{attrs:{plain:"",type:"success"}},[e._v("空闲")]):t("van-tag",{attrs:{plain:"",type:"danger"}},[e._v("出车中")]),t("a",{staticClass:"tel",attrs:{href:"tel:"+a.mobile}},[t("van-icon",{attrs:{name:"phone-o"}}),e._v(" "+e._s(a.mobile)+" ")],1)]},proxy:!0},0==a.status?{key:"right-icon",fn:function(){return[t("van-radio",{attrs:{name:a,"checked-color":"#467DB9"}})]},proxy:!0}:null],null,!0)})})),1)],1):t("van-checkbox-group",{model:{value:e.checkMultiData,callback:function(a){e.checkMultiData=a},expression:"checkMultiData"}},[t("van-cell-group",e._l(e.list,(function(a,r){return t("van-cell",{directives:[{name:"show",rawName:"v-show",value:a.show,expression:"item.show"}],key:r,scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(a.realname)+" "),0==a.status?t("van-tag",{attrs:{plain:"",type:"success"}},[e._v("空闲")]):t("van-tag",{attrs:{plain:"",type:"danger"}},[e._v("出车中")]),t("a",{staticClass:"tel",attrs:{href:"tel:"+a.mobile}},[t("van-icon",{attrs:{name:"phone-o"}}),e._v(" "+e._s(a.mobile)+" ")],1)]},proxy:!0},0==a.status?{key:"right-icon",fn:function(){return[t("van-checkbox",{attrs:{name:a,shape:"square","checked-color":"#467DB9"}})]},proxy:!0}:null],null,!0)})})),1)],1)],1)],1),t("div",{staticClass:"foot"},[t("div",[e._v(" 已选中 "),t("span",{staticClass:"num"},[e._v(e._s(e.selectNum))]),e._v("人 ")]),t("div",[t("van-button",{attrs:{round:"",type:"info",color:"#2F7DCD"},on:{click:e.handleConfirm}},[e._v("确定")])],1)])],1):e._e()},s=[],i=(t("99af"),t("4de4"),t("4160"),t("c975"),t("ac1f"),t("841c"),t("159b"),t("2909")),n=(t("96cf"),t("1da1")),o=t("365c"),c={name:"PickerDriver",props:{show:{type:Boolean,required:!0},single:{type:Boolean,default:!0},data:{type:Array,default:function(){return[]}}},data:function(){return{list:[],checkSingleData:"",checkMultiData:[],loading:!1,finished:!1,refreshing:!1,query:{search:"",page:0,pagesize:30},count:0,container:null}},computed:{_show:{get:function(){return this.show},set:function(e){this.$emit("update:show",e)}},selectNum:function(){return this.single?this.checkSingleData?1:0:this.checkMultiData.length}},watch:{_show:function(e){e&&(this.multipleSelectionAll=[],this.setCheckData(),this.finished=!1,this.query.search="",this.handleSearch())}},mounted:function(){this.container=this.$refs.container},methods:{setCheckData:function(){var e=this,a=this.list;this.multipleSelection=[],this.data.length>0&&(this.single?this.checkSingleData=a.filter((function(a){return a.id==e.data[0].id}))[0]:(this.data.forEach((function(t){e.multipleSelection.push(a.filter((function(e){return e.id==t.id}))[0])})),this.multipleSelectionAll=this.multipleSelection))},onLoad:function(){this.getDriverData(),this.refreshing?(this.query.page=1,this.list=[],this.refreshing=!1):this.query.page++},getDriverData:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var t,r,s,n,c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,o["d"].getDriver(e.query);case 3:t=a.sent,r=t.code,s=t.data,n=s.list,c=s.count,200===r?(e.list=n,e.count=c,1===e.query.page?e.list=n:e.list=[].concat(Object(i["a"])(e.list),Object(i["a"])(n)),n.length<=e.query.pagesize&&(e.finished=!0),e.list=e.converData(e.list)):e.finished=!0,e.list.forEach((function(e){e.show=!0})),a.next=15;break;case 12:a.prev=12,a.t0=a["catch"](0),e.finished=!0;case 15:case"end":return a.stop()}}),a,null,[[0,12]])})))()},converData:function(e){var a=[],t=[];return e.forEach((function(e){0==e.status?a.push(e):t.push(e)})),[].concat(a,t)},handleConfirm:function(){var e=[];this.selectNum>0?(e=this.single?this.checkSingleData:this.checkMultiData,this._show=!1,this.$emit("done",e)):this.$notify({type:"danger",message:"请选择人员",duration:1e3})},handleSearch:function(){var e=this.query.search;this.list.forEach((function(a){a.realname.indexOf(e)>-1?a.show=!0:a.show=!1})),this.$forceUpdate()},handleCancel:function(){this._show=!1},onRefresh:function(){this.finished=!1,this.loading=!0,this.onLoad()}}},l=c,p=(t("ca51"),t("2877")),u=Object(p["a"])(l,r,s,!1,null,"3d398859",null);a["a"]=u.exports},d3e7:function(e,a,t){"use strict";t.r(a);var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("van-skeleton",{attrs:{title:"",avatar:"",row:3,loading:e.loading}},[t("div",{staticClass:"info-box"},[t("div",{staticClass:"info"},[t("div",{staticClass:"title"},[t("van-image",{attrs:{width:"56",height:"56",src:e.info.avatar,radius:"4"}}),t("span",[e._v(e._s(e.info.user_name)+"的用车申请记录")]),0==e.info.status?t("van-tag",{attrs:{plain:"",type:"primary"}},[e._v("待审批")]):1==e.info.status&&1==e.info.car_use_status?t("van-tag",{attrs:{plain:"",type:"success"}},[e._v("已通过-等待出行")]):2==e.info.status?t("van-tag",{attrs:{plain:"",type:"warning"}},[e._v("已驳回")]):3==e.info.status?t("van-tag",{attrs:{plain:""}},[e._v("已撤销")]):1==e.info.status&&2==e.info.car_use_status?t("van-tag",{attrs:{plain:"",type:"primary"}},[e._v("已出场-用车中")]):1==e.info.status&&3==e.info.car_use_status?t("van-tag",{attrs:{plain:"",type:"primary"}},[e._v("已出场-回程中")]):1==e.info.status&&4==e.info.car_use_status?t("van-tag",{attrs:{plain:"",type:"primary"}},[e._v("已回场-用车结束")]):4==e.info.status&&0==e.info.car_use_status?t("van-tag",{attrs:{plain:"",type:"warning"}},[e._v("申请人取消用车")]):t("van-tag",{attrs:{plain:"",type:"primary"}},[e._v("已完成")])],1),t("div",{staticClass:"apply-info"},[t("p",[t("span",{staticClass:"prop-name"},[e._v("用车编号：")]),e._v(" "+e._s(e.info.approval_sn)+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("申请时间：")]),e._v(" "+e._s(e._f("timeFormat")(e.info.createtime,"yyyy-mm-dd"))+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("用车人电话：")]),e._v(" "+e._s(e.info.mobile)+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("所在部门：")]),e._v(" "+e._s(e.info.department_name)+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("车辆类型：")]),e._v(" "+e._s(e.info.type_name)+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("开始时间：")]),e._v(" "+e._s(e._f("timeFormat")(e.info.start_time,"yyyy-mm-dd"))+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("乘车人数：")]),e._v(" "+e._s(e.info.all_userid)+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("出发地：")]),e._v(" "+e._s(e.info.from_address)+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("目的地：")]),e._v(" "+e._s(e.info.to_address)+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("司机配备：")]),e._v(" "+e._s(1==e.info.have_driver?"需要":"不需要")+" ")]),t("p",[t("span",{staticClass:"prop-name"},[e._v("用车事由：")]),e._v(" "+e._s(e.info.cause)+" ")]),t("p",[e.info.log_cause?t("span",{staticClass:"prop-name"},[e._v("备注：")]):e._e(),t("span",{staticStyle:{color:"red"}},[e._v(e._s(e.info.log_cause))])])])]),t("div",{staticClass:"approve-box"},[t("div",{staticClass:"title"},[e._v("审批流程")]),t("van-steps",{attrs:{direction:"vertical",active:e.active,"active-color":"#0082EF"}},e._l(e.info.progress,(function(a,r){return t("van-step",{key:r,scopedSlots:e._u([e.active==r&&1==a.is_approval?{key:"active-icon",fn:function(){return[t("van-icon",{staticClass:"success",attrs:{name:"checked"}})]},proxy:!0}:2==a.is_approval?{key:"active-icon",fn:function(){return[t("van-icon",{staticClass:"close",attrs:{name:"clear"}})]},proxy:!0}:{key:"active-icon",fn:function(){return[t("i",{staticClass:"aprove"})]},proxy:!0}],null,!0)},[t("div",{staticClass:"item"},[t("div",{staticClass:"photo"},[t("van-icon",{attrs:{name:"friends"}})],1),t("div",{staticClass:"title"},[t("span",[t("span",{staticClass:"role-name"},[e._v(e._s(a.approve_name))]),1==a.is_approval?t("span",[e._v("·已同意")]):2==a.is_approval?t("span",[e._v("·已驳回")]):t("span",[e._v("·审核中")])]),t("span",[e._v("("+e._s(a.is_approval_number)+"/"+e._s(a.approval_number)+")")]),t("van-tag",{attrs:{type:"primary",plain:"",color:"#467DB9"}},[e._v(e._s(1===a.type?"会签":"或签"))]),a.user_list.length>0?t("van-icon",{attrs:{name:a.show?"arrow-up":"arrow-down"},on:{click:function(a){return e.handleUserShow(r)}}}):e._e(),a.is_approval_time>0?t("div",{staticClass:"time"},[t("span",[e._v(e._s(e._f("timeFormat")(a.is_approval_time,"mm-dd hh:mm")))])]):e._e()],1)]),t("ul",{directives:[{name:"show",rawName:"v-show",value:a.show,expression:"item.show"}],staticClass:"user-list"},e._l(a.user_list,(function(a){return t("li",{key:a.id},[t("div",{staticClass:"left"},[t("div",{staticClass:"photo"},[t("img",{attrs:{src:a.avatar}})]),e._v(" "+e._s(a.role_name?"("+a.role_name+")":"")+" "),t("span",[e._v(e._s(a.name)+e._s(1==a.is_approval?"·已同意":2==a.is_approval?"·已驳回":""))])]),a.is_approval_time>0?t("div",{staticClass:"time"},[e._v(e._s(e._f("timeFormat")(a.is_approval_time,"mm-dd hh:mm")))]):e._e()])})),0)])})),1)],1),t("div",{staticClass:"copyer"},[e._v("抄送人："+e._s(1==e.info.have_driver?"司机、":"")+e._s(e.info.copyer_name))]),1==e.info.is_can_deal&&1==e.approveStatus?t("div",{staticClass:"foot"},[t("div",{on:{click:function(a){return e.handleClick("pass")}}},[e._v("同意派车")]),t("div",{on:{click:function(a){return e.handleClick("refuse")}}},[e._v("拒绝派车")])]):e._e(),t("van-dialog",{attrs:{title:"提示","show-cancel-button":"","before-close":e.beforeClose},model:{value:e.show,callback:function(a){e.show=a},expression:"show"}},[t("div",{staticClass:"content"},[t("div",{staticClass:"message"},[e._v(e._s(e.msg[e.dialogType]))]),"pass"==e.dialogType?[1==e.info.have_driver&&1==e.info.is_first?t("van-field",{attrs:{label:"指派司机",readonly:"","input-align":"right","right-icon":"arrow",placeholder:"请选择司机"},on:{click:function(a){e.pickShow=!0}},model:{value:e.showData.driverName,callback:function(a){e.$set(e.showData,"driverName",a)},expression:"showData.driverName"}}):e._e(),1==e.info.is_first?t("van-field",{attrs:{label:"指派车辆",readonly:"","input-align":"right","right-icon":"arrow",placeholder:"请选择车辆"},on:{click:function(a){e.pickCarShow=!0}},model:{value:e.showData.carNumber,callback:function(a){e.$set(e.showData,"carNumber",a)},expression:"showData.carNumber"}}):e._e()]:e._e(),"refuse"==e.dialogType?t("van-field",{staticClass:"cause",attrs:{rows:"1",autosize:"",type:"textarea",maxlength:"50",placeholder:"请输入拒绝理由","show-word-limit":""},model:{value:e.cause,callback:function(a){e.cause=a},expression:"cause"}}):e._e()],2)]),t("picker-car",{attrs:{show:e.pickCarShow,single:!0,data:e.pickerCarData},on:{"update:show":function(a){e.pickCarShow=a},done:e.pickerCarDone}}),t("picker-driver",{attrs:{show:e.pickShow,single:!1,data:e.pickerDriverData},on:{"update:show":function(a){e.pickShow=a},done:e.pickerDone}})],1)])},s=[],i=(t("99af"),t("4de4"),t("4160"),t("a15b"),t("d81d"),t("b0c0"),t("159b"),t("96cf"),t("1da1")),n=t("365c"),o=t("d296"),c=t("63c5"),l=t("61f7"),p={components:{pickerDriver:o["a"],pickerCar:c["a"]},data:function(){return{loading:!0,show:!1,id:"",dialogType:"",cause:"",dirver:"",car:"",postData:{driver_id:"",car_id:""},showData:{driverName:"",carNumber:""},pickerCarData:[],pickerDriverData:[],pickShow:!1,pickCarShow:!1,msg:{pass:"是否通过审核",refuse:"是否拒绝该审批",close:"是否关闭该审批"},approveStatus:"1",info:{approval_sn:"",have_driver:"",mobile:"",from_address:"",to_address:"",all_userid:1,department:"",avatar:"",user_name:"",start_time:"",end_time:"",cause:"",createtime:"",status:"",car_use_status:"",type_name:"",department_name:"",all_user:[],is_can_deal:1,is_first:1},active:-1}},created:function(){this.id=this.$route.params.id,this.approveStatus=this.$route.params.status,this.getData()},methods:{getData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var t,r,s,i,o,c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,n["a"].getInfo({id:e.id,type:2});case 2:t=a.sent,r=t.msg,s=t.code,i=t.data,200===s?(e.loading=!1,o="",c="",e.info=Object.assign({},i),Object(l["a"])(e.info.from_address)&&(o=JSON.parse(e.info.from_address),c=JSON.parse(e.info.to_address),e.info.from_address="".concat(o.area," ").concat(o.detail),e.info.to_address="".concat(c.area," ").concat(c.detail)),e.info.progress=e.converProgress(e.info.progress),e.info.copyer_name=Array.isArray(e.info.copyer_user)?e.info.copyer_user.map((function(e){return e.name})).join("、"):""):(e.$notify({type:"danger",message:r,duration:1e3}),e.$router.push("/approve"));case 7:case"end":return a.stop()}}),a)})))()},converProgress:function(e){var a=this;return e.forEach((function(e){var t=[];1===e.approver_type?(e.user_list=e.leader_arr,e.approve_name="上级主管"):(e.user_list=e.role_user_arr,e.approve_name=e.approval_role.map((function(e){return e.role_name})).join("/")),t=e.user_list.filter((function(e){return e.is_approval>0})),e.show=!1,e.approval_number=e.user_list.length,e.is_approval_number=t.length,e.is_approval_time=e.is_approval_number>0?t[0].is_approval_time:0,e.is_approval=e.is_approval_number>0?t[0].is_approval:"",1==e.is_deal_approval&&(e.is_approval=e.last_approval_status,a.active++)})),e},setApproved:function(e,a){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var s,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,n["a"].approved(e);case 2:s=r.sent,i=s.code,o=s.msg,200===i?(a(),t.$router.push("/approve"),t.$notify({type:"success",message:o,duration:1e3})):(t.$notify({type:"danger",message:o,duration:1e3}),a(!1));case 6:case"end":return r.stop()}}),r)})))()},handleUserShow:function(e){this.info.progress[e].show=!this.info.progress[e].show,this.$forceUpdate()},handleClick:function(e){this.dialogType=e,this.show=!0},pickerDone:function(e){this.pickerDriverData=e,this.showData.driverName=e.map((function(e){return e.realname})).join("、"),this.postData.driver_id=e.map((function(e){return e.userid})).join(",")},pickerCarDone:function(e){this.pickerCarData=e,this.showData.carNumber=e.map((function(e){return e.car_number})).join("、"),this.postData.car_id=e.map((function(e){return e.id})).join(",")},beforeClose:function(e,a){if("confirm"===e)switch(this.dialogType){case"pass":1==this.info.is_first&&""==this.postData.driver_id&&1==this.info.have_driver?(this.$notify({type:"danger",message:"请选择司机",duration:1e3}),a(!1)):1==this.info.is_first&&""==this.postData.car_id?(this.$notify({type:"danger",message:"请选择车辆",duration:1e3}),a(!1)):this.setApproved(Object.assign(this.postData,{approval_id:this.id,status:1}),a);break;case"refuse":""===this.cause?(this.$notify({type:"danger",message:"请输入拒绝原因",duration:1e3}),a(!1)):this.setApproved({approval_id:this.id,cause:this.cause,status:2},a);break;default:break}else a()}}},u=p,d=(t("f72f"),t("2877")),v=Object(d["a"])(u,r,s,!1,null,"6a93c0be",null);a["default"]=v.exports},dc10:function(e,a,t){},f72f:function(e,a,t){"use strict";var r=t("dc10"),s=t.n(r);s.a}}]);